{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}MOVOS{% endblock %}</title>
    <link rel="icon" href="{% static 'img/pos-icon.png' %}" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    {% csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token }}">
    {% block extra_styles %}{% endblock %}
</head>
<body>
        <!-- Toast container for Django messages -->
        <div id="toast-container" class="position-fixed top-0 end-0 p-3" style="z-index: 1100;"></div>
        {% if messages %}
            <div id="django-messages" data-messages='[
                {% for message in messages %}{"level":"{{ message.tags|default:"info" }}","text":"{{ message|escapejs }}"}{% if not forloop.last %},{% endif %}{% endfor %}
            ]' hidden></div>
        {% endif %}
    {% if request.user.is_authenticated %}
        {% if request.user.is_superuser %}
            <!-- Navbar para admin: ahora se ve negra -->
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <a class="navbar-brand" href="{% url 'admin_dashboard' %}">Admin Dashboard</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="{% url 'sucursales:sucursal_list' %}">Sucursales</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'cashier_dashboard' %}">Cajero</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'product_management' %}">Productos</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'user_management' %}">Usuarios</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'reports:report_dashboard' %}">Reportes</a></li>
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="{% url 'logout' %}"
                               onclick="return confirm('¿Está seguro de cerrar sesión?');">Cerrar Sesión</a>
                        </li>
                    </ul>
                </div>
            </nav>
        {% else %}
            <!-- Navbar para usuarios no admin (ejemplo: cajeros) -->
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <a class="navbar-brand" href="{% url 'cashier_dashboard' %}">MOVOS</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarNavUser" aria-controls="navbarNavUser" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavUser">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="{% url 'cashier_dashboard' %}">Inicio</a></li>
                        <li class="nav-item">
                            <a class="nav-link text-danger" href="{% url 'logout' %}"
                               onclick="return confirm('¿Está seguro de cerrar sesión?');">Cerrar Sesión</a>
                        </li>
                    </ul>
                </div>
            </nav>
        {% endif %}
    {% endif %}
    
    <main class="container-fluid my-4">
         {% block page_wrapper_start %}
             <div class="content-max">
                 <div class="card page-card p-4">
         {% endblock %}

         {% block content %}{% endblock %}

         {% block page_wrapper_end %}
                 </div>
             </div>
         {% endblock %}
    </main>
    
    <footer class="bg-dark text-light text-center py-3">
         <div class="container">
              <p class="mb-0">&copy; 2024 MOVOS. Todos los derechos reservados.</p>
         </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Render Django messages as Bootstrap toasts using data attribute to avoid template tags in JS
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('toast-container');
            const holder = document.getElementById('django-messages');
            if (!holder) return;
            let msgs = [];
            try { msgs = JSON.parse(holder.getAttribute('data-messages') || '[]'); } catch (e) { msgs = []; }
            const mapLevel = (lvl) => {
                if (!lvl) return 'secondary';
                if (lvl.includes('error')) return 'danger';
                if (lvl.includes('warning')) return 'warning';
                if (lvl.includes('success')) return 'success';
                if (lvl.includes('info')) return 'info';
                return 'secondary';
            };
            msgs.forEach(m => {
                const t = document.createElement('div');
                t.className = `toast align-items-center text-white bg-${mapLevel(m.level)} border-0`;
                t.setAttribute('role', 'alert');
                t.innerHTML = '<div class="d-flex">\
                    <div class="toast-body"></div>\
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>\
                </div>';
                t.querySelector('.toast-body').textContent = m.text;
                container.appendChild(t);
                new bootstrap.Toast(t, { delay: 4000 }).show();
            });
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>